{"version":3,"file":"focustrap.js","sources":["../../src/util/focustrap.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap (v5.1.3): util/focustrap.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport EventHandler from '../dom/event-handler'\nimport SelectorEngine from '../dom/selector-engine'\nimport { getDocument } from './index'\nimport Config from './config'\n\n/**\n * Constants\n */\n\nconst NAME = 'focustrap'\nconst DATA_KEY = 'bs.focustrap'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst EVENT_FOCUSIN = `focusin${EVENT_KEY}`\nconst EVENT_KEYDOWN_TAB = `keydown.tab${EVENT_KEY}`\n\nconst TAB_KEY = 'Tab'\nconst TAB_NAV_FORWARD = 'forward'\nconst TAB_NAV_BACKWARD = 'backward'\n\nconst Default = {\n  trapElement: null, // The element to trap focus inside of\n  autofocus: true\n}\n\nconst DefaultType = {\n  trapElement: 'element',\n  autofocus: 'boolean'\n}\n\n/**\n * Class definition\n */\n\nclass FocusTrap extends Config {\n  constructor(config) {\n    super()\n    this._config = this._getConfig(config)\n    this._isActive = false\n    this._lastTabNavDirection = null\n    this._document = getDocument()\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  activate() {\n    if (this._isActive) {\n      return\n    }\n\n    if (this._config.autofocus) {\n      this._config.trapElement.focus()\n    }\n\n    EventHandler.off(this._document, EVENT_KEY) // guard against infinite focus loop\n    EventHandler.on(this._document, EVENT_FOCUSIN, event => this._handleFocusin(event))\n    EventHandler.on(this._document, EVENT_KEYDOWN_TAB, event => this._handleKeydown(event))\n\n    this._isActive = true\n  }\n\n  deactivate() {\n    if (!this._isActive) {\n      return\n    }\n\n    this._isActive = false\n    EventHandler.off(this._document, EVENT_KEY)\n  }\n\n  // Private\n  _handleFocusin(event) {\n    const { trapElement } = this._config\n\n    if (event.target === this._document || event.target === trapElement || trapElement.contains(event.target)) {\n      return\n    }\n\n    const elements = SelectorEngine.focusableChildren(trapElement)\n\n    if (elements.length === 0) {\n      trapElement.focus()\n    } else if (this._lastTabNavDirection === TAB_NAV_BACKWARD) {\n      elements[elements.length - 1].focus()\n    } else {\n      elements[0].focus()\n    }\n  }\n\n  _handleKeydown(event) {\n    if (event.key !== TAB_KEY) {\n      return\n    }\n\n    this._lastTabNavDirection = event.shiftKey ? TAB_NAV_BACKWARD : TAB_NAV_FORWARD\n  }\n}\n\nexport default FocusTrap\n"],"names":["NAME","DATA_KEY","EVENT_KEY","EVENT_FOCUSIN","EVENT_KEYDOWN_TAB","TAB_KEY","TAB_NAV_FORWARD","TAB_NAV_BACKWARD","Default","trapElement","autofocus","DefaultType","FocusTrap","Config","constructor","config","_config","_getConfig","_isActive","_lastTabNavDirection","_document","getDocument","activate","focus","EventHandler","off","on","event","_handleFocusin","_handleKeydown","deactivate","target","contains","elements","SelectorEngine","focusableChildren","length","key","shiftKey"],"mappings":"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"}