{"version":3,"file":"md-focusTrap.js","sources":["../../src/util/md-focusTrap.js"],"sourcesContent":["import MdSelectorEngine from '../dom/md-selector-engine'\nimport { isVisible } from './md-index'\n\nclass FocusTrap {\n  constructor(element, options = {}, toggler) {\n    this._element = element\n    this._toggler = toggler\n    this._event = options.event || 'blur'\n    this._condition = options.condition || (() => true)\n    this._selector =\n      options.selector || 'button, a, input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    this._onlyVisible = options.onlyVisible || false\n    this._focusableElements = []\n    this._firstElement = null\n    this._lastElement = null\n\n    this.handler = e => {\n      if (this._condition(e) && e.target === this._lastElement) {\n        e.preventDefault()\n        this._firstElement.focus()\n      }\n    }\n  }\n\n  trap() {\n    this._setElements()\n    this._init()\n    this._setFocusTrap()\n  }\n\n  disable() {\n    for (const element of this._focusableElements) {\n      element.removeEventListener(this._event, this.handler)\n    }\n\n    if (this._toggler) {\n      this._toggler.focus()\n    }\n  }\n\n  update() {\n    this._setElements()\n    this._setFocusTrap()\n  }\n\n  _init() {\n    const handler = e => {\n      if (!this._firstElement || e.key !== 'Tab' || this._focusableElements.includes(e.target)) {\n        return\n      }\n\n      e.preventDefault()\n      this._firstElement.focus()\n\n      window.removeEventListener('keydown', handler)\n    }\n\n    window.addEventListener('keydown', handler)\n  }\n\n  _filterVisible(elements) {\n    return elements.filter(el => {\n      if (!isVisible(el)) {\n        return false\n      }\n\n      const ancestors = MdSelectorEngine.parents(el, '*')\n\n      for (const ancestor of ancestors) {\n        const style = window.getComputedStyle(ancestor)\n        if (style && (style.display === 'none' || style.visibility === 'hidden')) {\n          return false\n        }\n      }\n\n      return true\n    })\n  }\n\n  _setElements() {\n    this._focusableElements = MdSelectorEngine.find(this._selector, this._element)\n\n    if (this._onlyVisible) {\n      this._focusableElements = this._filterVisible(this._focusableElements)\n    }\n\n    this._firstElement = this._focusableElements[0]\n    this._lastElement = this._focusableElements[this._focusableElements.length - 1]\n  }\n\n  _setFocusTrap() {\n    for (const [i, element] of this._focusableElements.entries()) {\n      if (i === this._focusableElements.length - 1) {\n        element.addEventListener(this._event, this.handler)\n      } else {\n        element.removeEventListener(this._event, this.handler)\n      }\n    }\n  }\n}\n\nexport default FocusTrap\n"],"names":["FocusTrap","constructor","element","options","toggler","_element","_toggler","_event","event","_condition","condition","_selector","selector","_onlyVisible","onlyVisible","_focusableElements","_firstElement","_lastElement","handler","e","target","preventDefault","focus","trap","_setElements","_init","_setFocusTrap","disable","removeEventListener","update","key","includes","window","addEventListener","_filterVisible","elements","filter","el","isVisible","ancestors","MdSelectorEngine","parents","ancestor","style","getComputedStyle","display","visibility","find","length","i","entries"],"mappings":"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"}