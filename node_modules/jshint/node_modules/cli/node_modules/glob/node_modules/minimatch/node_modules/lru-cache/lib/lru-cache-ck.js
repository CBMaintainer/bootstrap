(function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function t(){return 1}function n(i){function d(){if(h<=s)return;for(var e in l){if(h<=s)break;var t=l[e];a&&a(t.key,t.value);h-=t.length;delete f[t.key];delete l[e]}}if(!(this instanceof n))return new n(i);var s;if(typeof i=="number"){s=i;i={max:s}}s=i.max;i||(i={});var o=i.length||t;typeof o!="function"&&(o=t);if(!s||typeof s!="number"||s<=0)s=Infinity;var u=i.maxAge||null,a=i.dispose,f=Object.create(null),l=Object.create(null),c=0,h=0,p=0;Object.defineProperty(this,"max",{set:function(e){if(!e||typeof e!="number"||e<=0)e=Infinity;s=e;h>s&&d()},get:function(){return s},enumerable:!0});Object.defineProperty(this,"lengthCalculator",{set:function(e){if(typeof e!="function"){o=t;h=p;for(var n in f)f[n].length=1}else{o=e;h=0;for(var n in f){f[n].length=o(f[n].value);h+=f[n].length}}h>s&&d()},get:function(){return o},enumerable:!0});Object.defineProperty(this,"length",{get:function(){return h},enumerable:!0});Object.defineProperty(this,"itemCount",{get:function(){return p},enumerable:!0});this.reset=function(){if(a)for(var e in f)a(e,f[e].value);f={};l={};c=0;h=0;p=0};this.dump=function(){return f};this.set=function(t,n){if(e(f,t)){a&&a(t,f[t].value);u&&(f[t].now=Date.now());f[t].value=n;this.get(t);return!0}var i=o(n),v=u?Date.now():0,m=new r(t,n,c++,i,v);if(m.length>s){a&&a(t,n);return!1}h+=m.length;l[m.lu]=f[t]=m;p++;h>s&&d();return!0};this.get=function(t){if(!e(f,t))return;var n=f[t];if(u&&Date.now()-n.now>u){this.del(t);return}delete l[n.lu];n.lu=c++;l[n.lu]=n;return n.value};this.del=function(t){if(!e(f,t))return;var n=f[t];a&&a(t,n.value);delete f[t];delete l[n.lu];h-=n.length;p--}}function r(e,t,n,r,i){this.key=e;this.value=t;this.lu=n;this.length=r;this.now=i}typeof module=="object"&&module.exports?module.exports=n:this.LRUCache=n})();