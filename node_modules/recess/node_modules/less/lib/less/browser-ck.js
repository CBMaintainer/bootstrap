//
// browser.js - client-side engine
//
function initRunningMode(){if(less.env==="development"){less.optimization=0;less.watchTimer=setInterval(function(){less.watchMode&&loadStyleSheets(function(e,t,n,r,i){t&&createCSS(t.toCSS(),r,i.lastModified)})},less.poll)}else less.optimization=3}function loadStyles(){var e=document.getElementsByTagName("style");for(var t=0;t<e.length;t++)e[t].type.match(typePattern)&&(new less.Parser({filename:document.location.href.replace(/#.*$/,""),dumpLineNumbers:less.dumpLineNumbers})).parse(e[t].innerHTML||"",function(n,r){var s=r.toCSS(),o=e[t];o.type="text/css";o.styleSheet?o.styleSheet.cssText=s:o.innerHTML=s})}function loadStyleSheets(e,t){for(var n=0;n<less.sheets.length;n++)loadStyleSheet(less.sheets[n],e,t,less.sheets.length-(n+1))}function pathDiff(e,t){var n=extractUrlParts(e),r=extractUrlParts(t),i,s,o,u,a="";if(n.hostPart!==r.hostPart)return"";s=Math.max(r.directories.length,n.directories.length);for(i=0;i<s;i++)if(r.directories[i]!==n.directories[i])break;u=r.directories.slice(i);o=n.directories.slice(i);for(i=0;i<u.length-1;i++)a+="../";for(i=0;i<o.length-1;i++)a+=o[i]+"/";return a}function extractUrlParts(e,t){var n=/^((?:[a-z-]+:)?\/\/(?:[^\/\?#]+\/)|([\/\\]))?((?:[^\/\\\?#]+[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/,r=e.match(n),i={},s=[],o,u;if(!r)throw new Error("Could not parse sheet href - '"+e+"'");if(!r[1]||r[2]){u=t.match(n);if(!u)throw new Error("Could not parse page url - '"+t+"'");r[1]=u[1];r[2]||(r[3]=u[3]+r[3])}if(r[3]){s=r[3].replace("\\","/").split("/");for(o=0;o<s.length;o++)if(s[o]===".."&&o>0){s.splice(o-1,2);o-=2}}i.hostPart=r[1];i.directories=s;i.path=r[1]+s.join("/");i.fileUrl=i.path+(r[4]||"");i.url=i.fileUrl+(r[5]||"");return i}function loadStyleSheet(e,t,n,r){var i=e.contents||{},s=e.files||{},o=extractUrlParts(e.href,window.location.href),u=o.url,a=cache&&cache.getItem(u),f=cache&&cache.getItem(u+":timestamp"),l={css:a,timestamp:f},c;less.relativeUrls?less.rootpath?e.entryPath?c=extractUrlParts(less.rootpath+pathDiff(o.path,e.entryPath)).path:c=less.rootpath:c=o.path:less.rootpath?c=less.rootpath:e.entryPath?c=e.entryPath:c=o.path;xhr(u,e.type,function(a,f){session_cache+=a.replace(/@import .+?;/ig,"");if(!n&&l&&f&&(new Date(f)).valueOf()===(new Date(l.timestamp)).valueOf()){createCSS(l.css,e);t(null,null,a,e,{local:!0,remaining:r},u)}else try{i[u]=a;(new less.Parser({optimization:less.optimization,paths:[o.path],entryPath:e.entryPath||o.path,mime:e.type,filename:u,rootpath:c,relativeUrls:e.relativeUrls,contents:i,files:s,dumpLineNumbers:less.dumpLineNumbers})).parse(a,function(n,i){if(n)return error(n,u);try{t(n,i,a,e,{local:!1,lastModified:f,remaining:r},u);removeNode(document.getElementById("less-error-message:"+extractId(u)))}catch(n){error(n,u)}})}catch(h){error(h,u)}},function(e,t){throw new Error("Couldn't load "+t+" ("+e+")")})}function extractId(e){return e.replace(/^[a-z]+:\/\/?[^\/]+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")}function createCSS(e,t,n){var r,i=t.href||"",s="less:"+(t.title||extractId(i));if((r=document.getElementById(s))===null){r=document.createElement("style");r.type="text/css";t.media&&(r.media=t.media);r.id=s;var o=t&&t.nextSibling||null;(o||document.getElementsByTagName("head")[0]).parentNode.insertBefore(r,o)}if(r.styleSheet)try{r.styleSheet.cssText=e}catch(u){throw new Error("Couldn't reassign styleSheet.cssText.")}else(function(e){r.childNodes.length>0?r.firstChild.nodeValue!==e.nodeValue&&r.replaceChild(e,r.firstChild):r.appendChild(e)})(document.createTextNode(e));if(n&&cache){log("saving "+i+" to cache.");try{cache.setItem(i,e);cache.setItem(i+":timestamp",n)}catch(u){log("failed to save")}}}function xhr(e,t,n,r){function o(t,n,r){t.status>=200&&t.status<300?n(t.responseText,t.getResponseHeader("Last-Modified")):typeof r=="function"&&r(t.status,e)}var i=getXMLHttpRequest(),s=isFileProtocol?less.fileAsync:less.async;typeof i.overrideMimeType=="function"&&i.overrideMimeType("text/css");i.open("GET",e,s);i.setRequestHeader("Accept",t||"text/x-less, text/css; q=0.9, */*; q=0.5");i.send(null);isFileProtocol&&!less.fileAsync?i.status===0||i.status>=200&&i.status<300?n(i.responseText):r(i.status,e):s?i.onreadystatechange=function(){i.readyState==4&&o(i,n,r)}:o(i,n,r)}function getXMLHttpRequest(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){log("browser doesn't support AJAX.");return null}}function removeNode(e){return e&&e.parentNode.removeChild(e)}function log(e){less.env=="development"&&typeof console!="undefined"&&console.log("less: "+e)}function error(e,t){var n="less-error-message:"+extractId(t),r='<li><label>{line}</label><pre class="{class}">{content}</pre></li>',i=document.createElement("div"),s,o,u=[],a=e.filename||t,f=a.match(/([^\/]+(\?.*)?)$/)[1];i.id=n;i.className="less-error-message";o="<h3>"+(e.message||"There is an error in your .less file")+"</h3>"+'<p>in <a href="'+a+'">'+f+"</a> ";var l=function(e,t,n){e.extract[t]&&u.push(r.replace(/\{line\}/,parseInt(e.line)+(t-1)).replace(/\{class\}/,n).replace(/\{content\}/,e.extract[t]))};if(e.stack)o+="<br/>"+e.stack.split("\n").slice(1).join("<br/>");else if(e.extract){l(e,0,"");l(e,1,"line");l(e,2,"");o+="on line "+e.line+", column "+(e.column+1)+":</p>"+"<ul>"+u.join("")+"</ul>"}i.innerHTML=o;createCSS([".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"});i.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";");less.env=="development"&&(s=setInterval(function(){if(document.body){document.getElementById(n)?document.body.replaceChild(i,document.getElementById(n)):document.body.insertBefore(i,document.body.firstChild);clearInterval(s)}},10))}var isFileProtocol=/^(file|chrome(-extension)?|resource|qrc|app):/.test(location.protocol);less.env=less.env||(location.hostname=="127.0.0.1"||location.hostname=="0.0.0.0"||location.hostname=="localhost"||location.port.length>0||isFileProtocol?"development":"production");less.async=less.async||!1;less.fileAsync=less.fileAsync||!1;less.poll=less.poll||(isFileProtocol?1e3:1500);if(less.functions)for(var func in less.functions)less.tree.functions[func]=less.functions[func];var dumpLineNumbers=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(location.hash);dumpLineNumbers&&(less.dumpLineNumbers=dumpLineNumbers[1]);less.watch=function(){if(!less.watchMode){less.env="development";initRunningMode()}return this.watchMode=!0};less.unwatch=function(){clearInterval(less.watchTimer);return this.watchMode=!1};/!watch/.test(location.hash)&&less.watch();var cache=null;if(less.env!="development")try{cache=typeof window.localStorage=="undefined"?null:window.localStorage}catch(_){}var links=document.getElementsByTagName("link"),typePattern=/^text\/(x-)?less$/;less.sheets=[];for(var i=0;i<links.length;i++)(links[i].rel==="stylesheet/less"||links[i].rel.match(/stylesheet/)&&links[i].type.match(typePattern))&&less.sheets.push(links[i]);var session_cache="";less.modifyVars=function(e){var t=session_cache;for(name in e)t+=(name.slice(0,1)==="@"?"":"@")+name+": "+(e[name].slice(-1)===";"?e[name]:e[name]+";");(new less.Parser).parse(t,function(e,t){createCSS(t.toCSS(),less.sheets[less.sheets.length-1])})};less.refresh=function(e){var t,n;t=n=new Date;loadStyleSheets(function(e,r,i,s,o){if(o.local)log("loading "+s.href+" from cache.");else{log("parsed "+s.href+" successfully.");createCSS(r.toCSS(),s,o.lastModified)}log("css for "+s.href+" generated in "+(new Date-n)+"ms");o.remaining===0&&log("css generated in "+(new Date-t)+"ms");n=new Date},e);loadStyles()};less.refreshStyles=loadStyles;less.refresh(less.env==="development");