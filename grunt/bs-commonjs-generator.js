'use strict';
var fs = require('fs');
var path = require('path');

var COMMONJS_BANNER = '// This file is autogenerated via the `commonjs` Grunt task. You can require() this file in a CommonJS environment.\n';

module.exports = function generateCommonJSModule(grunt, srcFilePath, destFilepath) {
  var srcFile = path.resolve(srcFilePath),
      destFile = path.resolve(destFilepath),
      moduleOutputJs = COMMONJS_BANNER,
      fileContent;

//  function srcPathToDestRequire(srcFilepath) {
//    var requirePath = path.relative(destDir, srcFilepath).replace(/\\/g, '/');
//    return 'require(\'' + requirePath + '\')';
//  }
//  var  + srcFiles.map(srcPathToDestRequire).join('\n');
  try {
    fileContent = fs.readFileSync(srcFile);
  }
  catch (err) {
    grunt.fail.warn(err);
  }
  moduleOutputJs += '\nmodule.exports = function(jQuery) {\n';
  moduleOutputJs += fileContent;
  moduleOutputJs += '\n\n};\n';
  
  try {
    fs.writeFileSync(destFile, moduleOutputJs);
  }
  catch (err) {
    grunt.fail.warn(err);
  }
  
  grunt.log.writeln('File ' + destFile.cyan + ' created.');
};
